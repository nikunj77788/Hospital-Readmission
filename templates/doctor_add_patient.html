<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Doctor Dashboard - Add Patient</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 20px; background-color: #f7f9fc; }
        h1 { margin-bottom: 20px; }
        .form-section { margin-bottom: 30px; }
        footer { text-align: center; color: #6c757d; margin-top: 40px; }
    </style>
</head>
<body>
<div class="container">
    <h1>üè• Doctor Dashboard - Add Patient</h1>
    <p>Welcome, {{ session['name'] }}! Enter patient information to predict readmission risk.</p>

    <!-- Navigation -->
    <div class="mb-4 d-flex gap-2 flex-wrap">
        <a href="/doctor" class="btn btn-primary">Doctor Dashboard</a>
        <a href="/logout" class="btn btn-danger">Logout</a>
    </div>

    <div class="card shadow-sm">
        <div class="card-body">
            <h3 class="card-title mb-3">Add New Patient</h3>
            <form id="patientForm">
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="name" class="form-label">Patient Name</label>
                        <input type="text" class="form-control" id="name" required>
                    </div>
                    <div class="col-md-6">
                        <label for="age" class="form-label">Age</label>
                        <input type="number" class="form-control" id="age" required>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="gender" class="form-label">Gender</label>
                        <select class="form-select" id="gender" required>
                            <option value="" disabled selected>Select</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label for="department" class="form-label">Department</label>
                        <input type="text" class="form-control" id="department" placeholder="E.g., Cardiology">
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="time_in_hospital" class="form-label">Time in Hospital (days)</label>
                        <input type="number" class="form-control" id="time_in_hospital" required>
                    </div>
                    <div class="col-md-6">
                        <label for="num_medications" class="form-label">Number of Medications</label>
                        <input type="number" class="form-control" id="num_medications" required>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="high_blood_pressure" class="form-label">High Blood Pressure</label>
                        <select class="form-select" id="high_blood_pressure" required>
                            <option value="" disabled selected>Select</option>
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label for="heart_disease" class="form-label">Heart Disease</label>
                        <select class="form-select" id="heart_disease" required>
                            <option value="" disabled selected>Select</option>
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="smoker" class="form-label">Smoker</label>
                        <select class="form-select" id="smoker" required>
                            <option value="" disabled selected>Select</option>
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label for="readmitted" class="form-label">Previously Readmitted</label>
                        <select class="form-select" id="readmitted" required>
                            <option value="" disabled selected>Select</option>
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                    </div>
                </div>

                <!-- Medications -->
                <div class="row mb-3">
                    <div class="col-md-3">
                        <label for="metformin" class="form-label">Metformin</label>
                        <select class="form-select" id="metformin">
                            <option value="" selected>Not Applicable</option>
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="insulin" class="form-label">Insulin</label>
                        <select class="form-select" id="insulin">
                            <option value="" selected>Not Applicable</option>
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="glipizide" class="form-label">Glipizide</label>
                        <select class="form-select" id="glipizide">
                            <option value="" selected>Not Applicable</option>
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="glyburide" class="form-label">Glyburide</label>
                        <select class="form-select" id="glyburide">
                            <option value="" selected>Not Applicable</option>
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                    </div>
                </div>

                <button type="submit" class="btn btn-success">Predict Readmission Risk</button>
            </form>

            <div id="result" class="mt-4"></div>
        </div>
    </div>

    <footer class="mt-5">
        <p>¬© 2025 SmartCare Health Portal | Managed by COO</p>
    </footer>
</div>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script>
$(document).ready(function() {
    $('#patientForm').on('submit', function(e) {
        e.preventDefault();

        // Collect form data
        const data = {
            name: $('#name').val(),
            age: $('#age').val(),
            gender: $('#gender').val(),
            department: $('#department').val(),
            time_in_hospital: $('#time_in_hospital').val(),
            num_medications: $('#num_medications').val(),
            high_blood_pressure: $('#high_blood_pressure').val(),
            heart_disease: $('#heart_disease').val(),
            smoker: $('#smoker').val(),
            readmitted: $('#readmitted').val(),
            metformin: $('#metformin').val(),
            insulin: $('#insulin').val(),
            glipizide: $('#glipizide').val(),
            glyburide: $('#glyburide').val()
        };

        // Send data to backend
        $.ajax({
            url: "/doctor/add_patient",
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify(data),
            success: function(response) {
                $('#result').html(
                    `<div class="alert alert-success">Predicted Risk: <strong>${response.ai_risk}</strong> (Score: ${response.ai_risk_score.toFixed(2)})</div>`
                );
                $('#patientForm')[0].reset();
            },
            error: function(err) {
                $('#result').html(`<div class="alert alert-danger">Error: ${err.responseJSON.error}</div>`);
            }
        });
    });
});
</script>
</body>
</html>
